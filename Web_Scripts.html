<script>


/* ============================================================
      SCRIPTS GERAIS PARA TODO O PROJETO (GLOBAL)
   ============================================================ */
  CURRENT_STEP = 1;
  CURRENT_DATA = null;
  
  selectedFinalidades = new Set();
  let modalCallback = null;


/* ============================================================
      MODAL GLOBAL DO SISTEMA
   ============================================================ */

function abrirModalSistema(titulo, mensagem, orientacao="", callback=null) {
    modalCallback = callback;

    document.getElementById("modalTitulo").innerText = titulo;
    document.getElementById("modalMensagem").innerText = mensagem;
    document.getElementById("modalOrientacao").innerText = orientacao;

    document.getElementById("modalOrientacao").style.display =
        orientacao ? "block" : "none";

    document.getElementById("modalSistema").style.display = "flex";
}



function fecharModalSistema() {
    const modal = document.getElementById("modalSistema");
    modal.style.display = "none";

    if (typeof modalCallback === "function") {
        modalCallback();
    }
}

function show_Nav_Cadastro(){
  document.getElementById("btnNav_Cadastro").style.display = "block";
}

function hide_Nav_Cadastro(){
  document.getElementById("btnNav_Cadastro").style.display = "none";
}


/* ============================================================
      VALIDAÇÃO COMPLETA DE CPF
   ============================================================ */
function calcularCPF(input) {

  let cpf = (input.value || "").toString().replace(/\D/g, "");
  input.value = cpf; // mantém só números no campo

  const erro = document.getElementById("CampoCPF-error");

  if (cpf.length < 11) {
    if (erro) erro.innerText = "CPF incompleto.";
    return false;
  }

  if (cpf.length > 11) {
    input.value = cpf.slice(0, 11);
    return false;
  }

  // Elimina CPFs repetidos
  if (/^(\d)\1{10}$/.test(cpf)) {
    if (erro) erro.innerText = "CPF inválido.";
    return false;
  }

  // Função para cálculo dos dígitos verificadores
  function calcDV(base, fator) {
    let total = 0;
    for (let i = 0; i < base.length; i++) {
      total += parseInt(base[i], 10) * (fator - i);
    }
    let resto = (total * 10) % 11;
    return resto === 10 ? 0 : resto;
  }

  const dv1 = calcDV(cpf.slice(0, 9), 10);
  const dv2 = calcDV(cpf.slice(0, 10), 11);

  if (dv1 !== parseInt(cpf[9], 10) || dv2 !== parseInt(cpf[10], 10)) {
    if (erro) erro.innerText = "CPF inválido.";
    return false;
  }

  // CPF válido
  if (erro) erro.innerText = "";
  return true;
}


function resetarAplicacao() {

  // limpa campos visuais
  const selGrupo = document.getElementById("selectGrupo");
  if (selGrupo) selGrupo.value = "";

  document.querySelectorAll("#finalidadeList input[type='checkbox']")
          .forEach(cb => cb.checked = false);

  const idsToClear = [
    "clinica_restricao",
    "data_inicio_restricao",
    "descricao_curso",
    "periodo_curso"
  ];

  idsToClear.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = "";
  });

  // checkbox concluir
  const consent = document.getElementById("consentCheckbox");
  if (consent) consent.checked = false;

  const btn = document.getElementById("btnSalvarFinal");
  if (btn) btn.disabled = true;

  // reabilita campo CPF
  const c = document.getElementById("CampoCPF");
  if (c) {
    c.disabled = false;
    c.classList.remove("input-desabilitado");
  }

  // NÃO ALTERA AS ABAS — o hideWizard já faz isso!
  //console.log("Aplicação resetada.");
}




/* ----------- Normalizar CPF (apenas números) ----------- */
function normalizeCPF(cpf) {
  if (!cpf) return "";
  return cpf.toString().replace(/\D/g, "");
}


/* ============================================================
      EXIBIR MENSAGEM TEMPORÁRIA (TOAST)
   ============================================================ */
function toast(msg, cor = "blue") {

  const div = document.createElement("div");

  div.textContent = msg;
  div.style.position = "fixed";
  div.style.bottom = "20px";
  div.style.left = "50%";
  div.style.transform = "translateX(-50%)";
  div.style.padding = "12px 20px";
  div.style.borderRadius = "6px";
  div.style.color = "white";
  div.style.background = cor;
  div.style.zIndex = "9999";
  div.style.fontSize = "15px";
  div.style.boxShadow = "0 2px 6px rgba(0,0,0,0.25)";

  document.body.appendChild(div);

  setTimeout(() => div.remove(), 2500);
}


function mostrarCarregando(texto = "Processando...") {
  const overlay = document.getElementById("loadingOverlay");
  document.getElementById("loadingText").innerText = texto;
  overlay.style.display = "flex";
}

function esconderCarregando() {
  document.getElementById("loadingOverlay").style.display = "none";
}

/* ============================================================
      LIMPAR TODAS AS MENSAGENS DE ERRO DA PÁGINA
   ============================================================ */
function limparErros() {
  document.querySelectorAll(".error-message").forEach(el => {
    el.innerText = "";
  });
}


</script>
