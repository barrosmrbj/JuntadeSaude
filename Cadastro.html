<!-- pages/Cadastro.html -->
<h2>Cadastro do Inspecionando</h2>


<!-- CPF -->
<div class="linha-campo linha-campo-cpf">
  <label for="cadCPF">CPF</label>
  <input class="CampoCPF" id="cadCPF" type="text" maxlength="11" readonly>
</div>

<p >Complete os dados abaixo para prosseguir.</p>
<br>
<!-- V√çNCULO -->
<div class="linha-campo">
  <label>V√çNCULO </label><small class="texto-ajuda" ><i>Selecione apenas uma op√ß√£o<i></small>
  <div id="btnVinculo" class="grupo-status-botoes">
    <button data-v="AERONAUTICA">AERONAUTICA</button>
    <button data-v="DEPENDENTE">DEPENDENTE</button>
    <button data-v="DEPENDENTE">PENSIONISTAS</button>
    <button data-v="EXERCITO">EXERCITO</button>
    <button data-v="EMPRESA">EMPRESA</button>
    <button data-v="CANDIDATOS">CANDIDATOS</button>
  </div>
  
</div>

<!-- CAMPOS COMUNS -->
<div class="grupo-campos" id="campoComum" style="display:none;">

  <!-- ID -->
  <input id="cod" class="input-transparente" type="text" maxlength="12" readonly 
      style="font-size: 12px; background: transparent; border: none; text-align: right; opacity: 0.2; outline: none;">
  

  <h3>Dados Pessoais</h3>

  <div class="linha-campo">
    <label for="cadNome">Nome completo</label>
    <input id="cadNome" type="text">
  </div>

  <div class="linha-campos-dupla">
      <div class="linha-campo campo-metade">
          <label for="cadRG">Identidade</label>
          <input id="cadRG" type="text">
      </div>
      <div class="linha-campo campo-metade">
          <label for="cadORGAO">Org√£o EMISSOR</label>
          <input type="text" id="cadORGAO" list="listaORGAOS" class="form-control" placeholder="Selecione ou digite...">
          
          <datalist id="listaORGAOS">
              <option value="COMAER">Comando da Aeron√°utica</option>
              <option value="SSP">Sec. Seg P√∫blica - SSP</option>
              <option value="EXERCITO">Ex√©rcito Brasileiro</option>
              <option value="MARINHA">Marinha Brasileira</option>
          </datalist>
      </div>
  </div>

  <div class="linha-campo">
    <label for="cadDtNascimento">Data de Nascimento</label>
    <input id="cadDtNascimento" type="date">
  </div>

  <div class="linha-campo">
    <label for="cadNaturalidade">Naturalidade</label>
    <select id = "cadNaturalidade"  type="text">
      <option disabled selected>Selecione o estado</option>
      <option value="AC">Acre</option>
      <option value="AL">Alagoas</option>
      <option value="AP">Amap√°</option>
      <option value="AM">Amazonas</option>
      <option value="BA">Bahia</option>
      <option value="CE">Cear√°</option>
      <option value="DF">Distrito Federal</option>
      <option value="ES">Esp√≠rito Santo</option>
      <option value="GO">Goi√°s</option>
      <option value="MA">Maranh√£o</option>
      <option value="MT">Mato Grosso</option>
      <option value="MS">Mato Grosso do Sul</option>
      <option value="MG">Minas Gerais</option>
      <option value="PA">Par√°</option>
      <option value="PB">Para√≠ba</option>
      <option value="PR">Paran√°</option>
      <option value="PE">Pernambuco</option>
      <option value="PI">Piau√≠</option>
      <option value="RJ">Rio de Janeiro</option>
      <option value="RN">Rio Grande do Norte</option>
      <option value="RS">Rio Grande do Sul</option>
      <option value="RO">Rond√¥nia</option>
      <option value="RR">Roraima</option>
      <option value="SC">Santa Catarina</option>
      <option value="SP">S√£o Paulo</option>
      <option value="SE">Sergipe</option>
      <option value="TO">Tocantins</option>
    </select>
  </div>

  <div class="linha-campo">
    <label for="cadSexo">Sexo</label>
    <select id="cadSexo">
      <option value="">-- selecione --</option>
      <option value="MASC">Masculino</option>
      <option value="FEM">Feminino</option>
    </select>
  </div>

  <div class="linha-campo">
    <label for="cadEmail">E-mail</label>
    <input 
      id="cadEmail" 
      type="email" 
      placeholder="exemplo@dominio.com.br" 
      oninput="validarEmailAoDigitar(this)" 
      required
    >
  </div>

  <div class="linha-campo">
    <label for="cadEndereco">Endere√ßo (Rua/Av - N¬∞ Casa - Bairro - Estado)</label>
    <input id="cadEndereco" type="text">
  </div>

  <div class="linha-campo">
    <label for="cadTelefone">Telefone </label>
    <input id="cadTelefone" type="text">
  </div>

  <div class="linha-campo">
    <label for="cadTpSang">Tipo Sangu√≠neo</label>
    <select id="cadTpSang" name="fatorsanguineo">
        <option value="" disabled selected>--- Selecione ---</option>
        <option value="A+">A+ (A Positivo)</option>
        <option value="A-">A- (A Negativo)</option>
        <option value="B+">B+ (B Positivo)</option>
        <option value="B-">B- (B Negativo)</option>
        <option value="AB+">AB+ (AB Positivo)</option>
        <option value="AB-">AB- (AB Negativo)</option>
        <option value="O+">O+ (O Positivo)</option>
        <option value="O-">O- (O Negativo)</option>
        <option value="NAO-SEI">N√£o sei</option>
    </select>
  </div>

  <div class="linha-campo">
    <label for="cadCor">Cor</label>
    <select id="cadCor" name="Cor">
      <option value="" disabled selected>--- Selecione ---</option>
      <option value="BRANCA">BRANCA</option>
      <option value="PRETA">PRETA</option>
      <option value="PARDA">PARDA</option>
      <option value="AMARELA">AMARELA</option>
      <option value="INDIGENA">INDIGENA</option>
    </select>   
  </div>

  <div class="linha-campo">
    <label for="cadNacionalidade">Nacionalidade</label>
    <input id="cadNacionalidade" type="text" value="BRASILEIRA" readonly>
  </div>
</div>

  <!-- CAMPOS ESPEC√çFICOS -->
  <div class="grupo-campos" id="campoVinculo"></div>

  <div class="area-botoes">
    <button class="btn-voltar" onclick="go('Consulta')">Voltar</button>
    <button id="btnSalvar" class="btn-primario">Cadastrar Inspecionando</button>
  </div>

  <datalist id="om-list"></datalist>
  <datalist id="grupo-list"></datalist>
<script>
/* =========================================================
   VIEW: CADASTRO
========================================================= */
window.__VIEW_REGISTRY = window.__VIEW_REGISTRY || {};

window.__VIEW_REGISTRY['Cadastro'] = function (exports, APP, Store) {

  let vinculoAtual = null;
  let codControle = null; // RENOMEADO para refletir o uso apenas do COD
  let modoOperacao = "CADASTRAR"; // NOVO: CADASTRAR ou EDITAR

  /* NOVO: Fun√ß√£o para popular os datalists */
  function popularDatalists() {
      // Gera as OPTIONS para OM
      const omListElement = document.getElementById('om-list');
      if (omListElement && window.APP.OM_LIST) {
          let htmlOptions = window.APP.OM_LIST.map(item => `<option value="${item}">`).join('');
          omListElement.innerHTML = htmlOptions;
      }

      // Gera as OPTIONS para GRUPO
      const grupoListElement = document.getElementById('grupo-list');
      if (grupoListElement && window.APP.GRUPOS_LIST) {
          let htmlOptions = window.APP.GRUPOS_LIST.map(item => `<option value="${item}">`).join('');
          grupoListElement.innerHTML = htmlOptions;
      }
  }

  /* ---------------- INIT: L√≥gica de Edi√ß√£o ---------------- */
  const dadosEdicao = Store.get("dadosEdicao");
  const modoDaStore = Store.get("modoCadastro");
  const cpf = Store.get("cpfCadastro");

  // 1. Define o modo de opera√ß√£o
  if (modoDaStore === "EDITAR" && dadosEdicao) {
      modoOperacao = "EDITAR";
      // Usa SOMENTE o cod para identifica√ß√£o
      codControle = dadosEdicao.cod;
  }

  // 2. Limpa a store ap√≥s obter os dados
  Store.set("cpfCadastro", null);
  Store.set("dadosEdicao", null);
  Store.set("modoCadastro", null);

  // 3. Popula o CPF (seja para cadastro ou edi√ß√£o)
  document.getElementById("cadCPF").value = dadosEdicao?.cpf || cpf || '';

  // 4. Se for Edi√ß√£o, pr√©-preenche a tela
  if (modoOperacao === "EDITAR") {
      document.querySelector('h2').textContent = "Edi√ß√£o de Cadastro";
      document.getElementById("btnSalvar").textContent = "Salvar Edi√ß√£o";
      
      preencherCampos(dadosEdicao);

      esconderCarregando();

  } else {
      // Modo CADASTRAR
      document.querySelector('h2').textContent = "Cadastro do Inspecionando";
  }

  popularDatalists(); // <-- CHAME A FUN√á√ÉO AQUI NO IN√çCIO!
  bind();

  // Fun√ß√µes de pr√©-preenchimento
  function preencherCampos(data) {
      console.log("Modo Edi√ß√£o ativado. COD:", codControle);

      // ------------------------------------------
      // Pr√©-preenchimento dos Campos Comuns
      // ------------------------------------------
      document.getElementById("cod").value = data.cod || '';


      document.getElementById("cadNome").value = data.nome || '';
      document.getElementById("cadRG").value = data.rg || '';
      document.getElementById("cadORGAO").value = data.orgao || '';
      
      // Converte a data de DD/MM/AAAA (do GAS) para AAAA-MM-DD (do input type="date")
      if (data.nascimento && data.nascimento.includes('/')) {
          document.getElementById("cadDtNascimento").value = data.nascimento.split('/').reverse().join('-');
      } else {
          document.getElementById("cadDtNascimento").value = data.nascimento || '';
      }
      
      document.getElementById("cadNaturalidade").value = data.naturalidade || '';
      document.getElementById("cadSexo").value = data.sexo || '';
      document.getElementById("cadEmail").value = data.email || '';
      document.getElementById("cadEndereco").value = data.endereco || '';
      document.getElementById("cadTelefone").value = data.telefone || '';
      document.getElementById("cadTpSang").value = data.tp_sang || '';
      document.getElementById("cadCor").value = data.cor || '';
      
      // ------------------------------------------
      // Pr√©-preenchimento dos Campos de V√≠nculo
      // ------------------------------------------
      const vinculoParaSelecionar = data.vinculo?.toUpperCase();
      if (vinculoParaSelecionar) {
          const btnVinculo = document.querySelector(`#btnVinculo button[data-v="${vinculoParaSelecionar}"]`);
          if (btnVinculo) {
              // Seleciona o v√≠nculo (isso chamar√° gerarCamposVinculo e injetar√° o HTML)
              selecionarVinculo(btnVinculo);
              
              // Os campos espec√≠ficos do v√≠nculo s√≥ existem no DOM ap√≥s selecionarVinculo()
              // Por isso, populamos o restante AQUI (ap√≥s a sele√ß√£o)
              setTimeout(() => {
                  document.getElementById("cadSaram") && (document.getElementById("cadSaram").value = data.saram || '');
                  document.getElementById("cadOM") && (document.getElementById("cadOM").value = data.om || '');
                  document.getElementById("cadPosto") && (document.getElementById("cadPosto").value = data.posto || '');
                  document.getElementById("cadQuadro") && (document.getElementById("cadQuadro").value = data.quadro || '');
                  document.getElementById("cadEspecialidade") && (document.getElementById("cadEspecialidade").value = data.especialidade || '');
                  document.getElementById("cadGrupo") && (document.getElementById("cadGrupo").value = data.grupo || '');
                  
                  // L√≥gica adicional para valida√ß√£o do email
                  const cadEmail = document.getElementById('cadEmail');
                  if (cadEmail) validarEmailAoDigitarLocal(cadEmail);

              }, 50); // Pequeno delay para garantir que o DOM foi atualizado
          }
      }
  } //fim da fun√ß√£o preencherCampos(data)  

  function bind() {
    document.querySelectorAll("#btnVinculo button").forEach(btn => {
      btn.onclick = () => selecionarVinculo(btn);
    });

    document.getElementById("btnSalvar").onclick = salvarCadastro;
  }

  /* NOVO: Fun√ß√£o de Valida√ß√£o em Tempo Real */
  function validarEmailAoDigitarLocal(inputElement) {
    const email = inputElement.value;
    
    // Regex rigoroso para checar o formato geral (Nome@Dominio.Extensao)
    const regexEmail = /^[^\s@]+@[^\s@]+\.[^\s@]{2,6}$/; 
    
    // 1. Limpa classes se o campo estiver vazio
    if (email.trim() === "") {
        inputElement.classList.remove('invalido', 'valido');
        return;
    }

    // 2. Testa o formato
    if (regexEmail.test(email)) {
        inputElement.classList.remove('invalido');
        inputElement.classList.add('valido'); 
    } else {
        inputElement.classList.remove('valido');
        inputElement.classList.add('invalido');
    }
  }

  // üí° PASSO CRUCIAL: Expor a fun√ß√£o para o escopo global
  // Isso garante que o oninput do HTML consiga cham√°-la.
  window.validarEmailAoDigitar = validarEmailAoDigitarLocal;

  function selecionarVinculo(btn) {
    vinculoAtual = btn.dataset.v;

    // feedback visual
    document.querySelectorAll("#btnVinculo button")
      .forEach(b => b.classList.remove("ativo"));
    btn.classList.add("ativo");

    document.getElementById("campoComum").style.display = "block";
    document.getElementById("campoVinculo").innerHTML =
      gerarCamposVinculo(vinculoAtual);
  }

  function gerarCamposVinculo(v) {
    if (v === "DEPENDENTE") {
      return `
        <h3>Dados do Dependente</h3>
        <div class="linha-campo"><label>Grupo</label><input id="cadGrupo" value="VA - DEP MIL / PENSIONISTAS" style="text-align: center" readonly></div>
        <div class="linha-campo"><label>Posto</label><input id="cadPosto" value="Dependente" style="text-align: center" readonly></div>
        <div class="linha-campo"><label>SARAM do Respons√°vel (7 d√≠gitos)</label><input id="cadSaram" style="text-align: center"></div>
      `;
    }

    if (v === "PENSIONISTA") {
      return `
        <h3>Dados do Pensionista</h3>
        <div class="linha-campo"><label>Grupo</label><input id="cadGrupo" value="VA - DEP MIL / PENSIONISTAS" style="text-align: center" readonly></div>
        <div class="linha-campo"><label>Posto</label><input id="cadPosto" value="Pensionista" style="text-align: center" readonly></div>
        <div class="linha-campo"><label>SARAM do Respons√°vel (7 d√≠gitos)</label><input id="cadSaram" style="text-align: center"></div>
      `;
    }

    if (v === "CONCURSO") {
      return `
        <h3>Dados do Civil</h3>
        <div class="linha-campo"> <label for="cadOM">OM V√çCULO</label> <input id="cadOM" value="SEREP-MN" style="text-align: center" readonly> </div>
        <div class="linha-campo"><label>Grupo</label><input id="cadGrupo" value="VB - CIVIS (CONCURSO)" style="text-align: center" readonly></div>
        <div class="linha-campo"><label>Posto</label>
            <select id="cadPosto" style="text-align: center">
                <option value="" disabled selected>--- Selecione ---</option>
                <option value="CANDIDATO">CANDIDATO</option>
                <option value="RECRUTA">RECRUTA</option>
            </select>
        </div>
        <div class="linha-campo"><label>Quadro</label><input id="cadQuadro" style="text-align: center"></div>
        <div class="linha-campo"><label>Especialidade</label><input id="cadEspecialidade" style="text-align: center"></div>
      `;
    }

    if (v === "AERONAUTICA") {
      return `
        <h3>Dados Militares</h3>
        <div class="linha-campo"> 
            <label for="cadOM">Organiza√ß√£o Militar</label> 
            <input 
                id="cadOM" 
                type="text" 
                list="om-list" 
                style="text-align: center"
            > 
        </div>        
        <div class="linha-campo"><label>SARAM / Numero de Ordem (7 d√≠gitos)</label><input id="cadSaram" style="text-align: center"></div>
        <div class="linha-campos-dupla">
              <div class="linha-campo campo-metade"><label>Posto</label><input id="cadPosto" style="text-align: center"></div>
              <div class="linha-campo campo-metade"><label>Quadro</label><input id="cadQuadro" style="text-align: center"></div>
              <div class="linha-campo campo-metade"><label>Especialidade</label><input id="cadEspecialidade" style="text-align: center"></div>
        </div>
        <div class="linha-campo">
            <label>Indique o seu GRUPO atual</label>
            <input 
                id="cadGrupo" 
                type="text" 
                list="grupo-list" 
                style="text-align: center"
            >
        </div>
        
      `;
    }
    if (v === "EXERCITO") {
      return `
        <h3>Dados Militares</h3>
        <div class="linha-campo"> 
            <label for="cadOM">Organiza√ß√£o Militar</label> 
            <input 
                id="cadOM" 
                type="text" 
                list="om-list" 
                style="text-align: center"
            > 
        </div>      
        <div class="linha-campos-dupla">
              <div class="linha-campo campo-metade"><label>Posto</label><input id="cadPosto" style="text-align: center"></div>
              <div class="linha-campo campo-metade"><label>Especialidade</label><input id="cadEspecialidade" style="text-align: center"></div>
        </div>
        <div class="linha-campo">
            <label>Indique o seu GRUPO atual</label>
            <input 
                id="cadGrupo" 
                type="text" 
                list="grupo-list" 
                style="text-align: center"
            >
        </div>
        
      `;
    }    

    if (v === "EMPRESA") {
      return `
          <h3>Dados da Empresa</h3>
          <div class="linha-campo"><label>Matr√≠cula (7 d√≠gitos)</label><input id="cadSaram" style="text-align: center"></div>
          
          <div class="linha-campo"> 
            <label for="cadOM">Empresa/Organiza√ß√£o</label> 
            <input 
                id="cadOM" 
                type="text" 
                list="om-list" 
                style="text-align: center"
            > 
        </div> 
          <div class="linha-campo"><label>Grupo</label><input id="cadGrupo" value="III - Servidores CIVIS" style="text-align: center" readonly></div>

      `;
    }
    return "";
  }

  function validarCamposComuns() {
      let camposVazios = false;
      const campoDataNasc = document.getElementById("cadDtNascimento");
      const hoje = new Date();
      
      // 1. Array de campos para checar preenchimento
      const camposObrigatorios = [
          document.getElementById('cadNome'),
          document.getElementById('cadRG'),
          document.getElementById('cadORGAO'),
          campoDataNasc,
          document.getElementById('cadNaturalidade'),
          document.getElementById('cadSexo'),
          document.getElementById('cadEmail'),
          document.getElementById('cadEndereco'),
          document.getElementById('cadTelefone'),
          document.getElementById('cadTpSang'),
          document.getElementById('cadCor')
      ];

      // 2. Verifica primeiro se h√° campos vazios
      camposObrigatorios.forEach(campo => {
          if (!campo) return;
          if (campo.value === "" || campo.value.startsWith('--- Selecione ---') || campo.value.startsWith('Selecione o estado')) {
              campo.classList.add('invalido');
              camposVazios = true;
          } else {
              campo.classList.remove('invalido');
          }
      });

      if (camposVazios) {
          toast("Preencha todos os campos obrigat√≥rios em Dados Pessoais.", "red");
          return false; // Para aqui e mostra o erro de campos vazios
      }

      // 3. Se todos est√£o preenchidos, valida a REGRA DE IDADE
      const nascimento = new Date(campoDataNasc.value.replace(/-/g, '\/'));
      let idade = hoje.getFullYear() - nascimento.getFullYear();
      const m = hoje.getMonth() - nascimento.getMonth();
      if (m < 0 || (m === 0 && hoje.getDate() < nascimento.getDate())) {
          idade--;
      }

      if (idade < 18 && vinculoAtual !== "DEPENDENTE") {
          campoDataNasc.classList.add('invalido');
          toast("Aten√ß√£o: Data de Nascimento com idade >18 anos, corrija.", "red");
          return false; // Para aqui e mostra o erro de idade
      }

      return true; // S√≥ retorna true se passar em tudo
  }

    /* Fun√ß√£o Auxiliar para formatar data de AAAA-MM-DD para DD/MM/AAAA */
  function formatarDataBrasil(dataISO) {
      if (!dataISO) return "";
      
      // A data ISO (e.g., "1984-09-05") √© dividida em partes
      const partes = dataISO.split('-');
      
      // Verifica se tem 3 partes (Ano, M√™s, Dia)
      if (partes.length === 3) {
          // Retorna no formato DD/MM/AAAA
          const ano = partes[0];
          const mes = partes[1];
          const dia = partes[2];
          return `${dia}/${mes}/${ano}`;
      }
      return dataISO; // Retorna o valor original se o formato for inesperado
  }

  function salvarCadastro() {

      // 1. Verifica se o V√≠nculo foi selecionado
      if (!vinculoAtual) { toast("Selecione o v√≠nculo.", "red"); return; }
      
      // 2. Verifica os campos comuns obrigat√≥rios
      // Se a valida√ß√£o falhar, a fun√ß√£o retorna false e impede o envio.
      if (!validarCamposComuns()) { return; }
      
      // 3. Verifica o campo Email novamente (caso o usu√°rio tenha parado de digitar no inv√°lido)
      const cadEmail = document.getElementById('cadEmail');
      // Checa se o campo Email est√° marcado como inv√°lido pela valida√ß√£o em tempo real
      if (cadEmail.classList.contains('invalido')) { toast("Corrija o formato do E-mail.", "red"); return; }

      // 4. Se chegou at√© aqui, os dados s√£o v√°lidos. Prepara o payload (o resto da fun√ß√£o permanece igual)
      const payload = {
          cod: document.getElementById("cod")?.value || "",   
          // ... (seu payload) ...
          rg: document.getElementById("cadRG")?.value || "",
          orgao: document.getElementById("cadORGAO")?.value || "",
          dt_nascimento: formatarDataBrasil(document.getElementById("cadDtNascimento")?.value) || "",
          naturalidade: document.getElementById("cadNaturalidade")?.value || "",
          cpf: document.getElementById("cadCPF")?.value || "",
          sexo: document.getElementById("cadSexo")?.value || "",
          posto: document.getElementById("cadPosto")?.value || "",
          quadro: document.getElementById("cadQuadro")?.value || "",
          especialidade: document.getElementById("cadEspecialidade")?.value || "",
          nome: document.getElementById("cadNome")?.value.toUpperCase() || "",
          saram: document.getElementById("cadSaram")?.value || "",
          om: document.getElementById("cadOM")?.value || "",
          email: document.getElementById("cadEmail")?.value || "",
          endereco: document.getElementById("cadEndereco")?.value || "",
          telefone: document.getElementById("cadTelefone")?.value || "",
          grupo: document.getElementById("cadGrupo")?.value || "",
          tp_sang: document.getElementById("cadTpSang")?.value || "",
          cor: document.getElementById("cadCor")?.value || "",
          nacionalidade: "BRASILEIRA",          
          vinculo: vinculoAtual,
          senha: "",
          // NOVO: Campos de controle para o GAS
          modo_operacao: modoOperacao
                
      };

      // 1. Mensagens din√¢micas baseadas no modo
      const msgProcessando = modoOperacao === "EDITAR" ? "Atualizando cadastro..." : "Realizando novo cadastro...";
      const msgSucesso = modoOperacao === "EDITAR" ? "Edi√ß√£o realizada!" : "Cadastro realizado!";
      const gasFunction = modoOperacao === "EDITAR" ? "EditarInspecionando" : "SalvarInspecionando";
      
      /*let sucessoMsg = modoOperacao === "EDITAR" ? "Edi√ß√£o realizada" : "Cadastro realizado";
      let gasFunction = modoOperacao === "EDITAR" ? "EditarInspecionando" : "SalvarInspecionando"; // Adapte o nome da fun√ß√£o no seu Code.gs
      let sucessoDesc = modoOperacao === "EDITAR" ? "Dados atualizados com sucesso." : "Inspecionando cadastrado com sucesso.";*/

      // 2. Inicia o bloqueio da tela
      mostrarCarregando(msgProcessando);

      google.script.run
          .withSuccessHandler((res) => {
            esconderCarregando();
            hide_Nav_Cadastro();
                if (res && res.success) {
                        // Em vez de abrir modal de "OK", usamos o Toast (notifica√ß√£o r√°pida)
                        toast(msgSucesso, "green");

                        // 3. A√á√ÉO DIRETA: Ap√≥s cadastrar/editar, o que o sistema deve fazer?
                        // Sugest√£o: Voltar para a consulta com o cpf recem cadastrado
                        setTimeout(() => {
                          // Se o servidor retornou os dados atualizados em res.data, salvamos na Store
                          if (res.data) {
                              Store.set("dadosEdicao", res.data);
                          }
                          //Atualiza a store com o que veio do servidor
                          go("Consulta"); 
                        }, 1500); // Aguarda 1.5s para o usu√°rio ler o toast

                } else {
                        // Se houver erro de valida√ß√£o no servidor, avisamos com o Modal (pois exige aten√ß√£o)
                        abrirModalSistema("Aten√ß√£o", res.message, "Verifique os dados e tente novamente.");
                }
          })
          .withFailureHandler(err => {
              esconderCarregando();
              abrirModalSistema("Falha Cr√≠tica", "Erro de conex√£o com o servidor.", err.toString());
          })
          [gasFunction](payload);
  }//function salvarCadastro


  return{};/*{
    cleanup() {
      // üí° PASSO CRUCIAL 2: Limpar a fun√ß√£o do escopo global ao sair da p√°gina
      delete window.validarEmailAoDigitar; 
      document.getElementById("btnSalvar").onclick = null;
    }
  };*/
};

</script>

<style>

  /* Centraliza o texto dentro de TODOS os campos de texto e caixas de sele√ß√£o */
#app input[type="text"],
#app input[type="email"],
#app input[type="date"],
#app select,
#app textarea linha-campo{
    /* O ALINHAMENTO M√ÅGICO */
    text-align: center; 
    
    /* (Opcional) Ajustes de fonte para melhor visualiza√ß√£o */
    font-size: 1em; 
    font-weight: 500; /* Pode ajudar a destacar o valor centralizado */
}


/* Exce√ß√£o: Campos readonly (opcional) */
#app input[readonly] {
    /* Mantenha campos readonly centralizados, mas mude a cor para indicar que n√£o s√£o edit√°veis */
    background-color: #eee;
    color: #555;
    font-weight: bold;
}

/* ============================================================
    ESTILO BASE PARA OS BOT√ïES (Efeito 3D)
============================================================ */
.grupo-status-botoes button {
    /* (Manter as regras de tamanho e flexbox de antes) */
    min-width: 100px; 
    flex: 1 1 0; 
    text-align: center;
    padding: 10px 15px; 
    font-weight: bold;
    border: none;
    border-radius: 8px; /* Cantos levemente arredondados */
    cursor: pointer;
    transition: all 0.2s ease; /* Transi√ß√£o suave para o efeito 3D */
    
    /* ESTADO PADR√ÉO (Azul claro com sombra) */
    background-color: #f0f8ff; /* Azul muito claro */
    color: #0056b3; /* Cor do texto azul escuro */
    
    /* Sombra 3D: Deslocamento para baixo e para a direita simula profundidade */
    box-shadow: 0 4px 0 0 #0056b3; /* Sombra s√≥lida (a 'borda' 3D) */
    transform: translateY(0); /* Posi√ß√£o inicial */
}

/* ============================================================
    ESTADO DE HOVER (Azul escuro ao passar o mouse)
============================================================ */
.grupo-status-botoes button:hover {
    background-color: #007bff; /* Azul vibrante */
    color: white;
    /* Remove a sombra e move levemente para cima para simular que est√° sendo pressionado */
    box-shadow: 0 2px 0 0 #0056b3; 
    transform: translateY(-2px); 
}

/* ============================================================
    ESTADO ATIVO/SELECIONADO (Fundo Verde com Efeito Pressionado)
============================================================ */
.grupo-status-botoes button.ativo {
    background-color: #28a745; /* Verde de sucesso */
    color: white;
    
    /* Efeito Pressionado (Sombra menor e deslocamento para baixo) */
    box-shadow: 0 0 0 0 #218838; /* Sombra 'desaparece' */
    transform: translateY(4px); /* Move para baixo na profundidade */
    
    /* Remove a transi√ß√£o de hover para garantir que o estado ativo seja o foco */
    pointer-events: none; 
}

/* ============================================================
    ESTILO PARA GRUPOS DE CAMPOS (DIV COM BORDA)
============================================================ */
.grupo-campos {
    border: 1px solid #ccc; /* Borda cinza suave */
    border-radius: 10px; /* Cantos arredondados */
    padding: 15px; /* Espa√ßamento interno para afastar os campos da borda */
    margin-top: 25px; /* Espa√ßo acima do grupo */
    margin-bottom: 25px; /* Espa√ßo abaixo do grupo */
    background-color: #f9f9f9; /* Fundo levemente cinza para destacar */
}

/* Opcional: Ajusta o t√≠tulo para que ele se destaque dentro do grupo */
.grupo-campos h3 {
    border-bottom: 2px solid #0056b3; /* Linha azul para separar o t√≠tulo */
    padding-bottom: 5px;
    margin-top: 0;
    margin-bottom: 15px;
    color: #0056b3;
}

/* ============================================================
    LAYOUT LADO A LADO (RG e √ìrg√£o)
============================================================ */
.linha-campos-dupla {
    display: flex; /* Ativa o Flexbox para colocar itens lado a lado */
    gap: 20px; /* Espa√ßo entre os dois campos */
    margin-bottom: 20px; /* Espa√ßo ap√≥s o grupo de campos duplos */
}

.campo-metade {
    /* Define que cada campo ocupe metade do espa√ßo e cres√ßa para preencher */
    flex: 1 1 50%; 
    /* Garante que o input dentro deste campo use 100% da largura dispon√≠vel */
    width: 100%; 
}

/* Opcional: Garante que os inputs dentro da .campo-metade se comportem corretamente */
.campo-metade input, .campo-metade select {
    width: 100%;
    /* ... mantenha os estilos de centraliza√ß√£o de texto j√° definidos ... */
}

/* ============================================================
    FEEDBACK DE VALIDA√á√ÉO DE CAMPO
============================================================ */
/* Estilo para campos que falharam na valida√ß√£o */
#app input.invalido {
    border: 2px solid red !important;
    box-shadow: 0 0 5px rgba(255, 0, 0, 0.5);
    transition: border 0.3s;
}

/* Estilo para campos que passaram na valida√ß√£o */
#app input.valido {
    border: 2px solid green !important;
    box-shadow: 0 0 5px rgba(0, 255, 0, 0.3);
    transition: border 0.3s;
}

</style>
