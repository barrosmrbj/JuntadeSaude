<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - JUNTA DE SAÚDE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding: 20px; font-family: sans-serif; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); display: none; justify-content: center; align-items: center; z-index: 9999; }
        
        /* Estilos originais que você enviou */
        .grupo-campos { border: 1px solid #ccc; border-radius: 10px; padding: 15px; margin-top: 25px; margin-bottom: 25px; background-color: #f9f9f9; }
        .grupo-campos h3 { border-bottom: 2px solid #0056b3; padding-bottom: 5px; color: #0056b3; }
        .linha-campo { margin-bottom: 15px; display: flex; flex-direction: column; }
        .linha-campo label { font-weight: bold; margin-bottom: 5px; }
        input, select { text-align: center; padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
        
        /* Botões com efeito 3D (do seu código original) */
        .grupo-status-botoes { display: flex; gap: 10px; flex-wrap: wrap; }
        .grupo-status-botoes button { 
            min-width: 100px; flex: 1 1 0; padding: 10px; font-weight: bold; border: none; border-radius: 8px; cursor: pointer;
            background-color: #f0f8ff; color: #0056b3; box-shadow: 0 4px 0 0 #0056b3; transition: all 0.2s;
        }
        .grupo-status-botoes button:hover { background-color: #007bff; color: white; transform: translateY(-2px); }
        .grupo-status-botoes button.ativo { background-color: #28a745; color: white; box-shadow: 0 0 0 0 #218838; transform: translateY(4px); }
        
        .invalido { border: 2px solid red !important; }
        .valido { border: 2px solid green !important; }
    </style>
</head>
<body>

<div id="loader" class="loading-overlay"><div class="spinner-border text-primary"></div></div>

<div class="container" style="max-width: 800px;">
    <h2>Cadastro do Inspecionando</h2>

    <div class="linha-campo">
        <label for="cadCPF">CPF</label>
        <input id="cadCPF" type="text" maxlength="11" readonly style="background-color: #eee;">
    </div>

    <p>Complete os dados abaixo para prosseguir.</p>

    <div class="linha-campo">
        <label>VÍNCULO <small><i>(Selecione uma opção)</i></small></label>
        <div id="btnVinculo" class="grupo-status-botoes">
            <button type="button" data-v="AERONAUTICA">AERONAUTICA</button>
            <button type="button" data-v="DEPENDENTE">DEPENDENTE</button>
            <button type="button" data-v="PENSIONISTAS">PENSIONISTAS</button>
            <button type="button" data-v="EXERCITO">EXERCITO</button>
            <button type="button" data-v="EMPRESA">EMPRESA</button>
            <button type="button" data-v="CANDIDATOS">CANDIDATOS</button>
        </div>
    </div>

    <div id="campoComum" style="display:none;" class="grupo-campos">
        <h3>Dados Pessoais</h3>
        <div class="linha-campo">
            <label for="cadNome">Nome completo</label>
            <input id="cadNome" type="text" placeholder="NOME COMPLETO">
        </div>

        <div class="row">
            <div class="col-md-6 linha-campo">
                <label for="cadRG">Identidade</label>
                <input id="cadRG" type="text">
            </div>
            <div class="col-md-6 linha-campo">
                <label for="cadORGAO">Orgão Emissor</label>
                <input type="text" id="cadORGAO" list="listaORGAOS">
                <datalist id="listaORGAOS">
                    <option value="COMAER">Comando da Aeronáutica</option>
                    <option value="SSP">Sec. Seg Pública - SSP</option>
                    <option value="EXERCITO">Exército Brasileiro</option>
                    <option value="MARINHA">Marinha Brasileira</option>
                </datalist>
            </div>
        </div>

        <div class="linha-campo">
            <label for="cadDtNascimento">Data de Nascimento</label>
            <input id="cadDtNascimento" type="date">
        </div>

        <div class="linha-campo">
          <label for="cadNaturalidade">Naturalidade</label>
          <select id = "cadNaturalidade"  type="text">
            <option disabled selected>Selecione o estado</option>
            <option value="AC">Acre</option>
            <option value="AL">Alagoas</option>
            <option value="AP">Amapá</option>
            <option value="AM">Amazonas</option>
            <option value="BA">Bahia</option>
            <option value="CE">Ceará</option>
            <option value="DF">Distrito Federal</option>
            <option value="ES">Espírito Santo</option>
            <option value="GO">Goiás</option>
            <option value="MA">Maranhão</option>
            <option value="MT">Mato Grosso</option>
            <option value="MS">Mato Grosso do Sul</option>
            <option value="MG">Minas Gerais</option>
            <option value="PA">Pará</option>
            <option value="PB">Paraíba</option>
            <option value="PR">Paraná</option>
            <option value="PE">Pernambuco</option>
            <option value="PI">Piauí</option>
            <option value="RJ">Rio de Janeiro</option>
            <option value="RN">Rio Grande do Norte</option>
            <option value="RS">Rio Grande do Sul</option>
            <option value="RO">Rondônia</option>
            <option value="RR">Roraima</option>
            <option value="SC">Santa Catarina</option>
            <option value="SP">São Paulo</option>
            <option value="SE">Sergipe</option>
            <option value="TO">Tocantins</option>
          </select>
        </div>
        
        <div class="linha-campo">
          <label for="cadSexo">Sexo</label>
          <select id="cadSexo">
            <option value="">-- selecione --</option>
            <option value="MASC">Masculino</option>
            <option value="FEM">Feminino</option>
          </select>
        </div>

        <div class="linha-campo">
            <label for="cadEmail">E-mail</label>
            <input id="cadEmail" type="email" placeholder="exemplo@dominio.com" oninput="validarEmail(this)">
        </div>
        
        <div class="linha-campo">
            <label for="cadTelefone">Telefone</label>
            <input id="cadTelefone" type="text" placeholder="(92) 99999-9999">
        </div>

        <div class="linha-campo">
          <label for="cadTpSang">Tipo Sanguíneo</label>
          <select id="cadTpSang" name="fatorsanguineo">
              <option value="" disabled selected>--- Selecione ---</option>
              <option value="A+">A+ (A Positivo)</option>
              <option value="A-">A- (A Negativo)</option>
              <option value="B+">B+ (B Positivo)</option>
              <option value="B-">B- (B Negativo)</option>
              <option value="AB+">AB+ (AB Positivo)</option>
              <option value="AB-">AB- (AB Negativo)</option>
              <option value="O+">O+ (O Positivo)</option>
              <option value="O-">O- (O Negativo)</option>
              <option value="NAO-SEI">Não sei</option>
          </select>
        </div>    
        
        <div class="linha-campo">
          <label for="cadCor">Cor</label>
          <select id="cadCor" name="Cor">
            <option value="" disabled selected>--- Selecione ---</option>
            <option value="BRANCA">BRANCA</option>
            <option value="PRETA">PRETA</option>
            <option value="PARDA">PARDA</option>
            <option value="AMARELA">AMARELA</option>
            <option value="INDIGENA">INDIGENA</option>
          </select>   
        </div>
        
        <div class="linha-campo">
          <label for="cadNacionalidade">Nacionalidade</label>
          <input id="cadNacionalidade" type="text" value="BRASILEIRA" readonly>
        </div>
        
        <div class="linha-campo"><label>OM</label><input id="cadOM" type="text" list="lista-oms"></div>
        <div class="linha-campo"><label>Posto/Grad</label><input id="cadPosto" type="text" list="lista-postos"></div>
        <div class="linha-campo"><label for="cadGrupo">Grupo</label><input id="cadGrupo" type="text" list="lista-grupos"></div> 

      </div>

    <!-- CAMPOS ESPECÍFICOS -->  
    <div id="campoVinculo"></div>

    <div class="d-flex justify-content-between mt-4">
        <button class="btn btn-secondary px-4" onclick="window.location.href='index.html'">Voltar</button>
        <button id="btnSalvar" class="btn btn-primary px-4">Cadastrar Inspecionando</button>
    </div>
</div>

<datalist id="lista-oms"></datalist>
<datalist id="lista-postos"></datalist>
<datalist id="lista-grupos"></datalist>

<footer class="text-center mt-5 p-3 text-muted border-top">
    Copyright © 2025 Developed by Sgt Barros - Junta de Saúde do HAMN.
</footer>

<script>
    const API_URL_INSP = "https://docs.google.com/spreadsheets/d/11IgiIAjSwYfK-F_rQrVqXhmI83ACaQbjRFwG2wiADtU/"; //banco inspecionandos
    const API_URL_GAS = "https://script.google.com/macros/s/AKfycbwFsMusddUIVVxtD7xC3GuSQlq4Q0njnC0JjEJeiAgvnxxk5IJJNzC3zV2eITOXr_Ne5Q/exec";
    let vinculoSelecionado = "";

    // 1. Inicialização
    window.onload = () => {
        const urlParams = new URLSearchParams(window.location.search);
        const cpf = urlParams.get('cpf');
        if (cpf) document.getElementById('cadCPF').value = cpf;
        
        configurarBotoesVinculo();
        carregarListasDoGAS();
        document.getElementById("btnSalvar").onclick = salvar;
    };

    function configurarBotoesVinculo() {
        document.querySelectorAll("#btnVinculo button").forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll("#btnVinculo button").forEach(b => b.classList.remove("ativo"));
                btn.classList.add("ativo");
                vinculoSelecionado = btn.dataset.v;
                document.getElementById("campoComum").style.display = "block";
                gerarCamposEspecificos(vinculoSelecionado);
            };
        });
    }

    function gerarCamposEspecificos(v) {
        const container = document.getElementById("campoVinculo");
        container.innerHTML = ""; // Limpa
        
        let html = `<div class="grupo-campos"><h3>Dados de ${v}</h3>`;
        
        if (v === "AERONAUTICA" || v === "EXERCITO") {
            html += `
                <div class="linha-campo"><label>SARAM/Ordem</label><input id="cadSaram" type="text"></div>
            `;
        } else {
            html += `<div class="linha-campo"><label>Informações Adicionais</label><input id="cadObs" type="text"></div>`;
        }
        
        html += `</div>`;
        container.innerHTML = html;
    }

    function validarEmail(input) {
        const regex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
        if (regex.test(input.value)) {
            input.classList.replace("invalido", "valido") || input.classList.add("valido");
        } else {
            input.classList.replace("valido", "invalido") || input.classList.add("invalido");
        }
    }

    async function salvar() {
        if (!vinculoSelecionado) return alert("Selecione o vínculo!");
        
        document.getElementById('loader').style.display = 'flex';
        
        const payload = {
            action: "salvarInspecionando",
            cpf: document.getElementById("cadCPF").value,
            nome: document.getElementById("cadNome").value.toUpperCase(),
            vinculo: vinculoSelecionado,
            rg: document.getElementById("cadRG").value,
            email: document.getElementById("cadEmail").value,
            // Adicione os outros campos aqui...
        };

        try {
            const query = new URLSearchParams(payload).toString();
            const response = await fetch(`${API_URL_INSP}?${query}`, { redirect: 'follow' });
            const res = await response.json();

            if (res.success) {
                alert("Cadastro realizado com sucesso!");
                window.location.href = "roteiro.html";
            } else {
                alert("Erro: " + res.message);
            }
        } catch (err) {
            alert("Erro ao salvar dados.");
        } finally {
            document.getElementById('loader').style.display = 'none';
        }
    }
    // Chame esta função dentro do window.onload
    async function carregarListasDoGAS() {
        try {
            const response = await fetch(`${API_URL_GAS}?action=getDadosIniciais`);
            const res = await response.json();

            if (res.success) {
                console.log("Dados recebidos do GAS:", res);
                // Preenche as OMs
                popularDatalist("lista-oms", res.oms);
                // Preenche os Postos
                popularDatalist("lista-postos", res.postos);
                // Preenche os Grupos
                popularDatalist("lista-grupos", res.grupos);
            }
        } catch (error) {
            console.error("Erro ao carregar listas:", error);
        }
    }

    function popularDatalist(id, lista) {
        const elemento = document.getElementById(id);
        if (!elemento || !lista) return;
        
        // Transforma o array em várias tags <option>
        elemento.innerHTML = lista.map(item => `<option value="${item}">`).join('');
    }
</script>
</body>
</html>